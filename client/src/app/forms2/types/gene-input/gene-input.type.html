<cvc-entity-tag
  *ngIf="tagCacheId$ | ngrxPush as cacheId"
  [cvcCacheId]="cacheId"
  cvcMode="closeable"
  (cvcOnClose)="onTagClose$.next($event)"></cvc-entity-tag>
<nz-select
  *ngIf="!(tagCacheId$ | ngrxPush)"
  nzShowSearch
  nzServerSearch
  nzAllowClear
  [class.ng-dirty]="showError"
  [nzPlaceHolder]="props.placeholder"
  [formControl]="formControl"
  [formlyAttributes]="field"
  [nzOptionHeightPx]="28"
  (ngModelChange)="onSelect$.next($event)"
  (nzOnSearch)="onSearch$.next($event)"
  (ngModelChange)="props.change && props.change(field, $event)">
  <ng-container *ngFor="let item of result$ | ngrxPush">
    <nz-option
      nzCustomContent
      [nzValue]="item.id">
      <nz-space nzDirection="horizontal">
        <cvc-entity-tag
          *nzSpaceItem
          [cvcCacheId]="item.__typename + ':' + item.id"
          [cvcEmphasize]="searchString"></cvc-entity-tag>
        <span
          *nzSpaceItem
          nz-typography
          nzType="secondary">
          ID: {{ item.id }}
          <span *ngIf="item.geneAliases.length > 0"> - Aliases: </span>
          <span
            [innerHtml]="
              item.geneAliases.join(', ')
                | highlightTypeahead:searchString
            "></span>
        </span>
      </nz-space>
    </nz-option>
  </ng-container>
</nz-select>
